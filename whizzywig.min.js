//fixed 62 link>new window Chrome bug //link an image //td border hint //insHTML deletes selection in Chrome 
//fixed 63 IE9 breaks whereAmI()
//Copyright Â© 2005-2011 John Goodman - www.unverse.net  *date 110802
//Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
//THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
whizzywig={version:"Whizzywig v64",btn:[],btn:{_w:16,_h:16,_f:"icons.png"},buttonPath:"",buttonExt:"",cssFile:"",imageBrowse:"",linkBrowse:"",idTa:"",oW:"",sel:"",rng:"",papa:"",trail:"",ppw:"",wn:window,msIE:("Microsoft Internet Explorer"==navigator.appName),sels:"",buts:"",vals:[],opts:[],dobut:[],whizzies:[],taOrigSize:[],makeWhizzyWig:function(c,t){this.idTa=c;this.whizzies[this.whizzies.length]=this.idTa;if(!document.designMode){if(this.idTa.nodeName=="TEXTAREA"){this.tagButs()}alert("Whizzywig "+this.t("editor not available for your browser"));return}var a=this.o(this.idTa).defaultValue?this.o(this.idTa).defaultValue:this.o(this.idTa).innerHTML?this.o(this.idTa).innerHTML:"";if(!this.o(this.idTa).rows<5){this.o(this.idTa).rows="15"}taWidth=this.o(this.idTa).style.width?this.o(this.idTa).style.width:this.o(this.idTa).cols+"ex";taHeight=this.o(this.idTa).style.height?this.o(this.idTa).style.height:this.o(this.idTa).rows+"em";this.taOrigSize[this.idTa]={w:taWidth,h:taHeight};var b=document.createElement("div");b.id="CONTAINER"+this.idTa+"";b.style.width=taWidth;var f=this.o(this.idTa);this.o(this.idTa).parentNode.replaceChild(b,this.o(this.idTa));this.o("CONTAINER"+this.idTa).appendChild(f);if(this.o(this.idTa).nodeName=="TEXTAREA"){this.o(this.idTa).style.color="#060";this.o(this.idTa).style.zIndex="2"}else{this.w('<input type="hidden" id="wzhid_'+this.idTa+'" name="'+this.idTa+'" />')}this.h(this.idTa);var r=this.o(this.idTa).parentNode;while(r.nodeName!="FORM"){r=r.parentNode}this.addEvt(r,"submit",this.syncTextarea);this.w('<style type="text/css">button {vertical-align:middle;padding:0;margin:1px 0} button img{vertical-align:middle;margin:-1px} select{vertical-align:middle;margin:1px}  .wzCtrl {background:ButtonFace; border:2px outset ButtonShadow; padding:5px;} #sourceTa{color:#060;font-family:mono;}</style>');var p="formatblock fontname fontsize";var s=" bold italic underline | left center right justify | number bullet indent outdent | undo redo | color hilite rule | link image table | clean html spellcheck fullscreen ";var h=" tstart add_row_above add_row_below delete_row | add_column_before add_column_after delete_column | table_in_cell";var l="";btns=(s+h).split(" ");for(var g=0,q=0;g<btns.length;g++){if(btns[g]&&btns[g]!="|"&&btns[g]!="tstart"){this.btn[btns[g]]=this.btn._w*q++}}t=t?t.toLowerCase():"all";if(t=="all"){t=p+" newline "+this.buts+s+h}else{t+=h}this.w("<div onmouseover=\"whizzywig.c('"+this.idTa+'\')"><div id="CONTROLS'+this.idTa+'" class="wzCtrl" unselectable="on">');gizmos=t.split(" ");for(g=0;g<gizmos.length;g++){if(gizmos[g]){if(gizmos[g]=="tstart"){this.w('<div id="TABLE_CONTROLS'+this.idTa+'" style="display:none" unselectable="on">');l="</div>"}else{if(gizmos[g]=="|"){this.w('&nbsp;<big style="padding-bottom:2em">|</big>&nbsp;')}else{if(gizmos[g]=="newline"){this.w("<br>")}else{if((p+this.sels).indexOf(gizmos[g])!=-1){this.makeSelect(gizmos[g])}else{if((s+this.buts+h).indexOf(gizmos[g])!=-1){this.makeButton(gizmos[g])}}}}}}}this.w(l);this.w('<a href="http://www.unverse.net" style="color:buttonface" title="'+this.version+'">.</a> ');this.w(this.fGo("LINK"));if(this.linkBrowse){this.w('<input type="button" onclick=whizzywig.doWin("'+this.linkBrowse+'"); value="'+this.t("Browse")+'"> ')}this.w(this.t("Link address (URL)")+': <input type="text" id="lf_url'+this.idTa+'" size="60"><br><input type="button" value="http://" onclick="whizzywig.o(\'lf_url'+this.idTa+"').value='http://'+whizzywig.o('lf_url"+this.idTa+'\').value"> <input type="button" value="mailto:" onclick="whizzywig.o(\'lf_url'+this.idTa+"').value='mailto:'+whizzywig.o('lf_url"+this.idTa+'\').value"><input type="checkbox" id="lf_new'+this.idTa+'">'+this.t("Open link in new window")+this.fNo(this.t("OK"),"whizzywig.insertLink()"));this.w(this.fGo("IMAGE"));if(this.imageBrowse){this.w('<input type="button" onclick=whizzywig.doWin("'+this.imageBrowse+'"); value="'+this.t("Browse")+'"> ')}this.w(this.t("Image address (URL)")+': <input type="text" id="if_url'+this.idTa+'" size="50"> <label title='+this.t("to display if image unavailable")+"><br>"+this.t("Alternate text")+':<input id="if_alt'+this.idTa+'" type="text" size="50"></label><br>'+this.t("Align")+':<select id="if_side'+this.idTa+'"><option value="none">_&hearts;_ '+this.t("normal")+'</option><option value="left">&hearts;= &nbsp;'+this.t("left")+'</option><option value="right">=&hearts; &nbsp;'+this.t("right")+"</option></select> "+this.t("Border")+':<input type="text" id="if_border'+this.idTa+'" size="20" value="0" title="'+this.t("number or CSS e.g. 3px maroon outset")+'"> '+this.t("Margin")+':<input type="text" id="if_margin'+this.idTa+'" size="20" value="0" title="'+this.t("number or CSS e.g. 5px 1em")+'">'+this.fNo(this.t("Insert Image"),"whizzywig.insertImage()"));this.w(this.fGo("TABLE")+this.t("Rows")+':<input type="text" id="tf_rows'+this.idTa+'" size="2" value="3"> <select id="tf_head'+this.idTa+'"><option value="0">'+this.t("No header row")+'</option><option value="1">'+this.t("Include header row")+"</option></select> "+this.t("Columns")+':<input type="text" id="tf_cols'+this.idTa+'" size="2" value="3"> '+this.t("Border width")+':<input type="text" id="tf_border'+this.idTa+'" size="2" value="1"> '+this.fNo(this.t("Insert Table"),"whizzywig.makeTable()"));this.w(this.fGo("COLOR")+'<input type="hidden" id="cf_cmd'+this.idTa+'"><div style="background:#000;padding:1px;height:22px;width:125px;float:left"><div id="cPrvw'+this.idTa+'" style="background-color:red; height:100%; width:100%"></div></div> <input type=text id="cf_color'+this.idTa+'" value="red" size=17 onpaste=whizzywig.vC(value) onblur=whizzywig.vC(value)> <input type="button" onmouseover=whizzywig.vC() onclick=whizzywig.sC() value="'+this.t("OK")+'">  <input type="button" onclick="whizzywig.hideDialogs();" value="'+this.t("Cancel")+'"><br> '+this.t("click below or enter a")+' <a href="http://www.unverse.net/colortable.htm" target="_blank">'+this.t("color name")+'</a><br clear=all> <table border=0 cellspacing=1 cellpadding=0 width=480 bgcolor="#000000">\n');var o=new Array("00","33","66","99","CC","FF");for(g=0;g<o.length;g++){this.w("<tr>");for(j=0;j<o.length;j++){for(k=0;k<o.length;k++){var v=o[g]+o[j]+o[k];this.w(' <td style="background:#'+v+';height:12px;width:12px" onmouseover=whizzywig.vC("#'+v+'") onclick=whizzywig.sC("#'+v+'")></td>\n')}}this.w("</tr>")}this.w("</table></div>\n");this.w("</div>\n");this.w('<div class="wzCtrl" id="showWYSIWYG'+this.idTa+'" style="display:none"><input type="button" onclick="whizzywig.showDesign();" value="'+this.t("Hide HTML")+'">');this.tagButs();this.w("</div>\n");this.w('<iframe style="border:1px inset ButtonShadow;width:100%;height:'+taHeight+'" src="javascript:;" id="whizzy'+this.idTa+'"></iframe></div>\n',true);var u="<html>\n<head>\n<style>td,th{border:1px dotted #888}</style>\n";if(this.cssFile){u+='<link media="all" type="text/css" href="'+this.cssFile+'" rel="stylesheet">\n'}u+='</head>\n<body id="'+this.idTa+'" style="background-image:none">\n'+this.tidyD(a)+"</body>\n</html>";this.oW=this.o("whizzy"+this.idTa).contentWindow;var n=this.oW.document;try{n.designMode="on"}catch(m){setTimeout('whizzywig.oW.designMode="on";',100)}n.open();n.write(u);n.close();if(this.oW.addEventListener){this.oW.addEventListener("keypress",this.kb_handler,true)}else{n.body.attachEvent("onpaste",function(){setTimeout("whizzywig.cleanUp()",10)})}this.addEvt(n,"mouseup",this.whereAmI);this.addEvt(n,"keyup",this.whereAmI);this.addEvt(n,"dblclick",this.doDbl);f=this.o(this.idTa);this.o("CONTAINER"+this.idTa).removeChild(this.o(this.idTa));this.o("CONTAINER"+this.idTa).appendChild(f);this.idTa=null},makeAll:function(b){var c,a=document.getElementsByTagName("TEXTAREA");for(c=0;c<a.length;c++){if(!a[c].id){a[c].id=a.name}this.makeWhizzyWig(a[c].id,b)}},addEvt:function(c,b,a){if(this.wn.addEventListener){c.addEventListener(b,a,false)}else{c.attachEvent("on"+b,a)}},doDbl:function(){if(whizzywig.papa.nodeName=="IMG"){whizzywig.doImage()}else{if(whizzywig.papa.nodeName=="A"){whizzywig.doLink()}}},makeButton:function(a){var c,b=a.substring(0,1).toUpperCase();b+=a.substring(1);b=this.t(b.replace(/_/g," "));if(!document.frames&&(a=="spellcheck")){return}if(this.o(this.idTa).nodeName!="TEXTAREA"&&a=="html"){return}if(!this.buttonExt){this.buttonExt=".gif"}if(this.buttonPath=="textbuttons"){c='<button type=button onClick=whizzywig.makeSo("'+a+'")>'+b+"</button>\n"}else{c='<button  title="'+b+'" type=button onClick=whizzywig.makeSo("'+a+'")>'+(this.btn[a]!=undefined?'<div style="width:'+this.btn._w+"px;height:"+this.btn._h+"px;background-image:url("+this.btn._f+");background-position:-"+this.btn[a]+'px 0px"></div>':'<img src="'+this.buttonPath+a+this.buttonExt+'" alt="'+b+'" onError="this.parentNode.innerHTML=this.alt">')+"</button>\n"}this.w(c)},fGo:function(a){return'<div id="'+a+"_FORM"+this.idTa+'" unselectable="on" style="display:none" onkeypress="if(event.keyCode==13) {return false;}"><hr>\n'},fNo:function(a,b){return' <input type="button" onclick="'+b+'" value="'+a+'"> <input type="button" onclick="whizzywig.hideDialogs();" value='+this.t("Cancel")+"></div>\n"},makeSelect:function(a){var b,c,e,d;if(a=="formatblock"){e="Heading";b=["<p>","<p>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<address>","<pre>"];c=[this.t("Choose style")+":",this.t("Paragraph"),this.t(e)+" 1 ",this.t(e)+" 2 ",this.t(e)+" 3 ",this.t(e)+" 4 ",this.t(e)+" 5 ",this.t(e)+" 6",this.t("Address"),this.t("Fixed width<pre>")]}else{if(a=="fontname"){b=["Arial, Helvetica, sans-serif","Arial, Helvetica, sans-serif","'Arial Black', Helvetica, sans-serif","'Comic Sans MS' fantasy","Courier New, Courier, monospace","Georgia, serif","Impact,sans-serif","'Times New Roman', Times, serif","'Trebuchet MS',sans-serif","Verdana, Arial, Helvetica, sans-serif"];c=[this.t("Font")+":","Arial","Arial Black","Comic","Courier","Georgia","Impact","Times New Roman","Trebuchet","Verdana"]}else{if(a=="fontsize"){b=["3","1","2","3","4","5","6","7"];c=[this.t("Font size")+":","1 "+this.t("Small"),"2","3","4","5","6","7 "+this.t("Big")]}else{b=this.vals[a];c=this.opts[a]}}}this.w('<select id="'+a+this.idTa+'" onchange="whizzywig.doSelect(this.id);">\n');for(d=0;d<b.length;d++){this.w(' <option value="'+b[d]+'">'+c[d]+"</option>\n")}this.w("</select>\n")},tagButs:function(){this.w('<input type="button" onclick=\'whizzywig.doTag("<h1>")\' value="H1" title="<H1>"><input type="button" onclick=\'whizzywig.doTag("<h2>")\' value="H2" title="<H2>"><input type="button" onclick=\'whizzywig.doTag("<h3>")\' value="H3" title="<H3>"><input type="button" onclick=\'whizzywig.doTag("<h4>")\' value="H4" title="<H4>"><input type="button" onclick=\'whizzywig.doTag("<p>")\' value="P" title="<P>"><input type="button" onclick=\'whizzywig.doTag("<strong>")\' value="S" title="<STRONG>" style="font-weight:bold"><input type="button" onclick=\'whizzywig.doTag("<em>")\' value="E" title="<EM>" style="font-style:italic;"><input type="button" onclick=\'whizzywig.doTag("<li>")\' value="&bull;&mdash;" title="<LI>"><input type="button" onclick=\'whizzywig.doTag("<a>")\' value="@" title="<A HREF= >"><input type="button" onclick=\'whizzywig.doTag("<img>")\' value="[&hearts;]" title="<IMG SRC= >"><input type="button" onclick=\'whizzywig.doTag("<br />")\' value="&larr;" title="<BR />">')},xC:function(b,a){return this.oW.document.execCommand(b,false,a)},makeSo:function(a,b){this.hideDialogs();this.oW.focus();if(this.dobut[a]){this.insHTML(this.dobut[a]);return}if(/Firefox/.test(navigator.userAgent)){this.xC("styleWithCSS",a=="hilite")}if(a=="justify"){a="full"}if("leftrightcenterfull".indexOf(a)!=-1){a="justify"+a}else{if(a=="number"){a="insertorderedlist"}else{if(a=="bullet"){a="insertunorderedlist"}else{if(a=="rule"){a="inserthorizontalrule"}}}}switch(a){case"color":this.o("cf_cmd"+this.idTa).value="forecolor";if(this.textSel()){this.s("COLOR_FORM"+this.idTa)}break;case"hilite":this.o("cf_cmd"+this.idTa).value=a;if(this.textSel()){this.s("COLOR_FORM"+this.idTa)}break;case"image":this.doImage();break;case"link":this.doLink();break;case"html":this.showHTML();break;case"table":this.doTable();break;case"delete_row":this.doRow("delete","0");break;case"add_row_above":this.doRow("add","0");break;case"add_row_below":this.doRow("add","1");break;case"delete_column":this.doCol("delete","0");break;case"add_column_before":this.doCol("add","0");break;case"add_column_after":this.doCol("add","1");break;case"table_in_cell":this.hideDialogs();this.s("TABLE_FORM"+this.idTa);break;case"clean":this.cleanUp();break;case"spellcheck":this.spellCheck();break;case"fullscreen":this.fullscreen();break;default:this.xC(a,b);break}this.oW.focus()},doSelect:function(b){var a=this.o(b).selectedIndex;var c=this.o(b).options[a].value;this.o(b).selectedIndex=0;b=b.replace(this.idTa,"");if(" _formatblock_fontname_fontsize".indexOf("_"+b)>0){var d=b;this.oW.focus();this.xC(d,c)}else{this.insHTML(c)}this.oW.focus()},vC:function(a){if(!a){a=this.o("cf_color"+this.idTa).value}this.o("cPrvw"+this.idTa).style.backgroundColor=a;this.o("cf_color"+this.idTa).value=a},sC:function(a){this.hideDialogs();var b=this.o("cf_cmd"+this.idTa).value;if(!a){a=this.o("cf_color"+this.idTa).value}if(this.rng){this.rng.select()}if(b=="hilite"){try{this.xC("hilitecolor",a)}catch(c){this.xC("backcolor",a)}}else{this.xC(b,a)}this.oW.focus()},doLink:function(){if(this.textSel()){if(this.papa.nodeName=="A"){this.o("lf_url"+this.idTa).value=this.papa.href}this.s("LINK_FORM"+this.idTa)}},insertLink:function(e){if(this.rng){this.rng.select()}var d,f,c="http://whizzy.wig/mark",b=e?e:this.o("lf_url"+this.idTa).value;if(b.replace(/ /g,"")===""){this.xC("Unlink",null)}else{this.xC("CreateLink",c);d=this.oW.document.body.getElementsByTagName("A");for(f=0;f<d.length;f++){if(d[f].href==c){d[f].href=b;if(this.o("lf_new"+this.idTa).checked){d[f].target="_blank"}break}}}this.hideDialogs()},doImage:function(){if(this.papa&&this.papa.nodeName=="IMG"){this.o("if_url"+this.idTa).value=this.papa.src;this.o("if_alt"+this.idTa).value=this.papa.alt;var a=this.papa.style.cssFloat?this.papa.style.cssFloat:this.papa.style.styleFloat;this.o("if_side"+this.idTa).selectedIndex=(a=="left")?1:(a=="right")?2:0;this.o("if_border"+this.idTa).value=this.papa.style.border?this.papa.style.border:this.papa.border>0?this.papa.border:0;this.o("if_margin"+this.idTa).value=this.papa.style.margin?this.papa.style.margin:this.papa.hspace>0?this.papa.hspace:0}this.s("IMAGE_FORM"+this.idTa)},insertImage:function(a,c,b,d,e){this.hideDialogs();if(!a){a=this.o("if_url"+this.idTa).value}if(a){if(!e){e=this.o("if_alt"+this.idTa).value?this.o("if_alt"+this.idTa).value:a.replace(/.*\/(.+)\..*/,"$1")}img='<img alt="'+e+'" src="'+a+'" ';if(!c){c=this.o("if_side"+this.idTa).value}if((c=="left")||(c=="right")){align="float:"+c+";"}else{align=""}if(!b){b=this.o("if_border"+this.idTa).value}if(b.match(/^\d+$/)){b+="px solid"}if(!d){d=this.o("if_margin"+this.idTa).value}if(d.match(/^\d+$/)){d+="px"}if(b||d){img+=' style="border:'+b+";margin:"+d+";"+align+'"'}img+="/>";if(this.papa.nodeName=="IMG"){this.papa.src=a;this.papa.alt=e;this.papa.style.border=b;this.papa.style.margin=d;this.papa.style.cssFloat=c;this.papa.style.styleFloat=c}else{this.insHTML(img)}}},doTable:function(){if(this.trail&&this.trail.indexOf("TABLE")>0){this.s("TABLE_CONTROLS"+this.idTa)}else{this.s("TABLE_FORM"+this.idTa)}},doRow:function(a,g){var c=this.papa,f,d,b,e;while(c.tagName!="TR"){c=c.parentNode}f=c.rowIndex;d=c.cells.length;while(c.tagName!="TABLE"){c=c.parentNode}if(a=="delete"){c.deleteRow(f)}else{b=c.insertRow(f+parseInt(g,10));for(i=0;i<d;i++){e=b.insertCell(i);e.innerHTML="#"}}},doCol:function(a,g){var d=this.papa,b,e,c,f;while(d.tagName!="TD"){d=d.parentNode}b=d.cellIndex;while(d.tagName!="TABLE"){d=d.parentNode}e=d.rows.length;for(c=0;c<e;c++){if(a=="delete"){d.rows[c].deleteCell(b)}else{f=d.rows[c].insertCell(b+parseInt(g,10));f.innerHTML="#"}}},makeTable:function(){this.hideDialogs();var f=this.o("tf_rows"+this.idTa).value,g=this.o("tf_cols"+this.idTa).value,b=this.o("tf_border"+this.idTa).value,d=this.o("tf_head"+this.idTa).value,e,c,a;if((f>0)&&(g>0)){e='<table border="'+b+'">';for(c=1;c<=f;c++){e=e+"<tr>";for(a=1;a<=g;a++){if(c==1){if(d=="1"){e+="<th>Title"+a+"</th>"}else{e+="<td>"+a+"</td>"}}else{if(a==1){e+="<td>"+c+"</td>"}else{e+="<td>#</td>"}}}e+"</tr>"}e+=" </table>";this.insHTML(e)}},doWin:function(a){this.ppw=this.wn.open(a,"popWhizz","toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=640,height=480,top=100");this.ppw.focus()},spellCheck:function(){try{var a=new ActiveXObject("ieSpell.ieSpellExtension");a.CheckAllLinkedDocuments(document)}catch(b){if(b.number==-2146827859){if(confirm("ieSpell is not installed on your computer. \n Click [OK] to go to download page.")){this.wn.open("http://www.iespell.com/download.php","DownLoad")}}else{alert("Error Loading ieSpell: Exception "+b.number)}}},getWinSize:function(){var a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth;var b=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;return{w:a,h:b}},fullscreen:function(){var a=this.o("CONTAINER"+this.idTa);if(!this.isFullscreen()){if(document.body.style.overflow){document.body.style.overflow="hidden"}else{document.documentElement.style.overflow="hidden"}document.body.style.visibility="hidden";a.style.visibility="visible";a.style.position="absolute";a.style.top=(window.pageYOffset?window.pageYOffset:document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop)+"px";a.style.left="0";a.style.width=this.getWinSize().w+"px";a.style.height=this.getWinSize().h+"px";this.o("whizzy"+this.idTa).style.backgroundColor="#fff";this.o("whizzy"+this.idTa).style.height=this.getWinSize().h-this.o("CONTROLS"+this.idTa).offsetHeight+"px"}else{if(document.body.style.overflow){document.body.style.overflow="visible"}else{document.documentElement.style.overflow=""}document.body.style.visibility="visible";a.style.position="relative";a.style.top=this.o(this.idTa).style.top?this.o(this.idTa).style.top:"0px";a.style.left=this.o(this.idTa).style.left?this.o(this.idTa).style.left:"0px";a.style.width=this.taOrigSize[this.idTa].w;a.style.height="auto";this.o("whizzy"+this.idTa).style.backgroundColor="transparent";this.o("whizzy"+this.idTa).style.height=this.taOrigSize[this.idTa].h}},getDir:function(){var b=location.href,c=document.getElementsByTagName("base"),a;for(a=0;a<c.length;a++){if(c[a].href){b=c[a].href}}c=document.getElementsByTagName("script");for(a=0;a<c.length;a++){if(c[a].src&&/(^|\/)whizzywig\.js([?#].*)?$/i.test(c[a].src)){return c[a].src.replace(/whizzywig\.js/i.exec(c[a].src),"")}else{if(c[a].src&&/(^|\/)whizzywig[^\/].*?\.js([?#].*)?$/i.test(c[a].src)){return c[a].src.replace(/whizzywig[^\/].*?\.js/i.exec(c[a].src),"")}}}return""},isFullscreen:function(){if(this.o("CONTAINER"+this.idTa).style.width==this.getWinSize().w+"px"){return true}return false},hideDialogs:function(){this.h("LINK_FORM"+this.idTa);this.h("IMAGE_FORM"+this.idTa);this.h("COLOR_FORM"+this.idTa);this.h("TABLE_FORM"+this.idTa);this.h("TABLE_CONTROLS"+this.idTa)},showDesign:function(){this.oW.document.body.innerHTML=this.tidyD(this.o(this.idTa).value);this.h(this.idTa);this.h("showWYSIWYG"+this.idTa);this.s("CONTROLS"+this.idTa);this.s("whizzy"+this.idTa);if(this.o("whizzy"+this.idTa).contentDocument){this.o("whizzy"+this.idTa).contentDocument.designMode="on"}this.oW.focus()},showHTML:function(){this.o(this.idTa).value=this.tidyH(this.oW.document);this.h("CONTROLS"+this.idTa);this.h("whizzy"+this.idTa);this.s(this.idTa);this.s("showWYSIWYG"+this.idTa);if(this.isFullscreen()){this.o(this.idTa).style.width=this.getWinSize().w+"px";this.o(this.idTa).style.height=(this.getWinSize().h-this.o("showWYSIWYG"+this.idTa).offsetHeight)+"px";this.o(this.idTa).style.borderWidth="0px"}else{this.o(this.idTa).style.position="relative";this.o(this.idTa).style.width=this.taOrigSize[this.idTa].w;this.o(this.idTa).style.height=this.taOrigSize[this.idTa].h;this.o(this.idTa).style.borderWidth="1px"}this.o(this.idTa).focus()},syncTextarea:function(){for(var c=0;c<whizzywig.whizzies.length;c++){var b=whizzywig.whizzies[c];var e=whizzywig.o("whizzy"+b).contentWindow.document;if(whizzywig.o(b).style.display=="block"){e.body.innerHTML=whizzywig.o(b).value}var a=(whizzywig.o(b).nodeName!="TEXTAREA")?whizzywig.o("wzhid_"+whizzywig.o(b).id):whizzywig.o(b);a.value=whizzywig.tidyH(e)}},cleanUp:function(){this.xC("removeformat",null);this.tidyH(this.oW.document)},tidyD:function(a){a=a.replace(/<(\/?)strong([^>]*)>/gi,"<$1B$2>").replace(/<(\/?)em>/gi,"<$1I>");return a},tidyH:function(l){function f(d){return d.toLowerCase()}function g(d){return d.replace(/(\s+\w+=)([^"][^>\s]*)/gi,'$1"$2"')}function b(d){return d.replace(/("|;)\s*[A-Z-]+\s*:/g,f)}var h=["medium","xx-small","x-small","small","medium","large","x-large","xx-large"],a=l.getElementsByTagName("FONT"),c,e;for(c=0;c<a.length;c++){if(a[c].face){a[c].style.fontFamily=a[c].face;a[c].removeAttribute("face")}if(a[c].size){a[c].style.fontSize=h[a[c].size];a[c].removeAttribute("size")}if(a[c].color){a[c].style.color=a[c].color;a[c].removeAttribute("color")}}e=l.body.innerHTML;e=e.replace(/(<\/?)FONT([^>]*)/gi,"$1span$2").replace(/(<\/?)[B](\s+[^>]*)?>/gi,"$1strong$2>").replace(/(<\/?)[I](\s+[^>]*)?>/gi,"$1em$2>").replace(/<\/?(COL|XML|ST1|SHAPE|V:|O:|F:|F |PATH|LOCK|IMAGEDATA|STROKE|FORMULAS)[^>]*>/gi,"").replace(/\bCLASS="?(MSOw*|Apple-style-span)"?/gi,"").replace(/<[^>]+=[^>]+>/g,g).replace(/<(TABLE|TD|TH|COL)(.*)(WIDTH|HEIGHT)=["'0-9A-Z]*/gi,"<$1$2").replace(/<([^>]+)>\s*<\/\1>/g,"").replace(/><(H|P|D|T|BLO|FOR|IN|SE|OP|UL|OL|LI|SC)/gi,">\n<$1").replace(/(<BR ?\/?>)([^\r\n])/gi,"$1\n$2").replace(/([^\n])<(P|DIV|TAB|FOR)/gi,"$1\n\n<$2").replace(/([^\n])<\/(UL|OL|DL|DIV|TAB|FOR)/gi,"$1\n</$2").replace(/([^\n])(<\/TR)/gi,"$1\n $2").replace(/\n<(BLO|LI|OP|TR|IN|DT)/gi,"\n <$1").replace(/\n<(TD|TH|DD)/gi,"\n  <$1").replace(window.location.href+"#","#").replace(/<(IMG|INPUT|BR|HR|LINK|META)([^>]*)>/gi,"<$1$2 />").replace(/(<\/?[A-Z]*)/g,f).replace(/STYLE="[^"]*"/gi,b);return e},kb_handler:function(d){var c=false,a=false,b;if(d&&(d.ctrlKey&&d.keyCode==d.DOM_VK_V)||(d.shiftKey&&d.keyCode==d.DOM_VK_INSERT)){setTimeout("whizzywig.cleanUp()",10)}else{if(d&&d.keyCode==13&&!d.shiftKey&&whizzywig.papa.nodeName=="BODY"){c="formatblock";a="<p>"}else{if(d&&d.ctrlKey){b=String.fromCharCode(d.charCode).toLowerCase();c=(b=="b")?"bold":(b=="i")?"italic":(b=="l")?"link":(b=="m")?"image":false}}}if(c){whizzywig.makeSo(c,a);d.preventDefault();d.stopPropagation()}},doTag:function(b){var a,f="",c,e;if(!b){b=prompt("Enter some HTML or text to insert:","")}this.o(this.idTa).focus();if(b=="<a>"){a=prompt("Link address:","http://");b='<a href="'+a+'">'}if(b=="<img>"){a=prompt("Address of image:","http://");var d=prompt("Description of image");b='<img src="'+a+'" alt="'+d+'">'}if(b.indexOf("<")===0&&b.indexOf("br")!=1&&b.indexOf("img")!=1){f=b.replace(/<([a-z0-6]+).*/,"</$1>")}if(b!="<strong>"&&b!="<em>"){f+="\n"}if(document.selection){this.sel=document.selection.createRange();this.sel.text=b+this.sel.text+f}else{c=this.o(this.idTa).value.slice(0,this.o(this.idTa).selectionStart);this.sel=this.o(this.idTa).value.slice(this.o(this.idTa).selectionStart,this.o(this.idTa).selectionEnd);e=this.o(this.idTa).value.slice(this.o(this.idTa).selectionEnd);this.o(this.idTa).value=c+b+this.sel+f+e}this.o(this.idTa).focus()},insHTML:function(html){if(!html){html=prompt(this.t("Enter some HTML or text to insert:"),"")}if(html.indexOf("js:")===0){try{eval(html.replace(/^js:/,""))}catch(e){}return}this.whereAmI();try{this.xC("inserthtml",html+this.sel)}catch(e){if(document.selection){if(this.papa&&this.papa.nodeName=="IMG"){this.papa.outerHTML=html+this.papa.outerHTML}else{if(this.rng){this.rng.select();this.rng.pasteHTML(html+this.rng.htmlText)}}}}},whereAmI:function(c){if(!c){c=whizzywig.wn.event}var a=c&&c.type=="mouseup",b,d;if(whizzywig.msIE){whizzywig.oW.document.getElementsByTagName("body")[0].focus();whizzywig.sel=whizzywig.oW.document.selection;whizzywig.rng=whizzywig.sel.createRange();whizzywig.papa=a?c.srcElement:(whizzywig.sel.type=="Control")?whizzywig.rng.item(0):whizzywig.rng.parentElement()}else{whizzywig.sel=whizzywig.oW.getSelection();sn=whizzywig.sel.anchorNode;whizzywig.papa=a?c.target:(sn.nodeName=="#text")?sn.parentNode:sn}b=whizzywig.papa;whizzywig.trail=whizzywig.papa.nodeName;while(!b.nodeName.match(/^(HTML|BODY)/)&&b.className!="wzCtrl"){b=b.parentNode;whizzywig.trail=b.nodeName+">"+whizzywig.trail}if(b.className=="wzCtrl"){whizzywig.trail=whizzywig.sel=whizzywig.rng=null}d=b.nodeName=="HTML"?b.getElementsByTagName("BODY")[0].id:b.id.replace("CONTROL","");whizzywig.c(d);whizzywig.wn.status=d+":"+whizzywig.trail;if(whizzywig.trail.indexOf("TABLE")>0){whizzywig.s("TABLE_CONTROLS"+whizzywig.idTa)}else{whizzywig.h("TABLE_CONTROLS"+whizzywig.idTa)}},c:function(b){if(b===""||this.whizzies.join().indexOf(b)=="-1"){return}if(b!=this.idTa){this.idTa=b;try{this.oW=this.o("whizzy"+b).contentWindow}catch(a){alert("set current: "+b)}if(this.oW){if(this.oW.focus){this.oW.focus()}this.wn.status=this.oW.document.body.id}}},w:function(b,a){if(!this.w.temp){this.w.temp=""}this.w.temp+=b;if(a){this.o("CONTAINER"+this.idTa).innerHTML+=this.w.temp;this.w.temp=""}},textSel:function(){if(this.sel&&this.sel.type!="None"&&this.sel.type!="Caret"){return true}else{alert(this.t("Select some text first"));return false}},s:function(a){this.o(a).style.display="block"},h:function(a){this.o(a).style.display="none"},o:function(a){return document.getElementById(a)},t:function(a){return(this.wn.language&&language[a])?language[a]:a}};whizzywig.btn._f=whizzywig.getDir()+"icons.png";
